<!DOCTYPE html>
<html lang="fr">

<head>
<meta charset="UTF-8">
<title>Set without order dependant properties via Promises \ Tests / Equatorium</title>
<meta name="author" content="Gaëtan Langhade, interfacteur">
</head>

<body>
<script src="-media/jquery-2.1.1.min.js"></script>
<script>
// promises in for…in: iteration without order of properties which certain depend on other properties
;(function () {
	"use strict";
	var selection = {
		setProperties: function (o) {
			selection.p = new Promise(function (r) {
				for (var k in o)
					(selection[k] = o[k]);
				r();
			});
		},
		checkProperty: function (ope) {
			var test = selection.calcul[ope]();
			if (test)
				return test;
			else {
				selection.P.push(Promise.resolve(selection.p).then(function () {
					selection.setProperties({
						[ope]: selection.checkProperty(ope)
					});
				}));
			}
		},
		calcul: {},
		P: []
	};

/* ---- */

	selection.calcul.trois = function () {
		return selection.deux ? selection.deux + "3" : false;
	}
	selection.calcul.deux = function () {
		return selection.un ? selection.un + "2" : false;
	}
	selection.calcul.un = function () {
		return "1";
	}
	selection.setProperties({
		trois: selection.checkProperty("trois"),
		deux: selection.checkProperty("deux"),
		un: selection.checkProperty("un")
	});

	Promise.resolve(selection.P[selection.P.length - 1]).then(function(){
		for (var k in selection)
			console.log(k, selection[k])
		console.log(selection["deux"], selection);
	});

}) ();
</script>
</body>
</html>
