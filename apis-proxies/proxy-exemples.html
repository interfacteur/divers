<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="fr" lang="fr">

<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Proxy de requêtes, outils perso \ Canopée ~ outils / Equatorium</title>
<meta name="author" content="Gaëtan Langhade, interfacteur">

<style type="text/css">
body	{
	font-family: Georgia, "Times New Roman", Times, serif;
	font-size: 120%;
	margin-top: 4px;
}
a	{
	color: #000;
}
a:hover,
a:focus	{
	color:  #A00;
	text-decoration: none;
}
h1	{
	font-size: 1.075em;
}
h2	{
	font-size: 1em;
}
li	{
	margin-bottom: .5em;
}
form	{
	position: absolute;
	left: -4444em;
	top: 0;
}
[type="text"]	{
	width: 44em;
}
output	{
	display: block;
	font-size: .75em;
	min-height: 24px;
}
output:nth-of-type(3) {
	height: 60px;
	overflow: hidden;
}
[type='submit']	{
	background: grey;
	border: 1px solid #8DA;
	color: #8DA;
	cursor: pointer;
	padding: .2em .75em;
}
</style>
</head>

<body>
<h1>Proxy de requêtes, outils perso</h1>
<p>Le proxy <a href="proxy.php">proxy.php</a> renvoie le fichier dans son type MIME d'origine&nbsp;:</p>
<ul>
	<li>text/plain :<br>
		<a href="proxy.php?query=http://www.interfacteur.net/apis/text.php">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		http://www.interfacteur.net/apis/text.php</a></li>
	<li>text/html :<br>
		<a href="proxy.php?query=http://gaetan.langhade.net">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		http://gaetan.langhade.net</a></li>
	<li>text/xml :<br>
		<a href="proxy.php?query=http://www.velib.paris/service/stationdetails/paris/1001">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		http://www.velib.paris/service/stationdetails/paris/1001</a></li>
	<li>application/json :<br>
		* <a href="proxy.php?query=https://www.googleapis.com/books/v1/volumes?q=isbn:0747532699">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		https://www.googleapis.com/books/v1/volumes?q=isbn:0747532699</a><br>
		* <a href="proxy.php?query=http://www.interfacteur.net/apis/json-mixte.php">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		http://www.interfacteur.net/apis/json-mixte.php</a></li>
	<li>text/javascript :<br>
		<a href="proxy.php?query=https://www.googleapis.com/books/v1/volumes?q=isbn:0747532699&callback=perform">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		https://www.googleapis.com/books/v1/volumes?q=isbn:0747532699&callback=perform</a></li>
	<li>application/javascript :<br>
		* <a href="proxy.php?query=https://api.github.com/search/repositories?q=form+in:name&type=Repositories&per_page=10&client_id=e8ce07d7ca81454ca7ca&callback=perform">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		https://api.github.com/search/repositories?q=form+in:name&type=Repositories&per_page=10&callback=perform</a><br>
		* <a href="proxy.php?query=http://www.interfacteur.net/apis/json-mixte.php?callback=perform">
		http://www.equatorium.net/e1/ou--outils/proxy.php?query=<br>
		http://www.interfacteur.net/apis/json-mixte.php?callback=perform</a></li>
	</li>
</ul>
<form action="#">
	<label for="test">Test localisé :</label>
	<input type="text" id="test" />
	<input type="submit" value="Tester" />
	<br>
	<output id="resultat1"></output>
	<output id="resultat2"></output>
	<output id="resultat3"></output>
</form>
<script src="-media/jquery-2.1.1.min.js"></script>
<script>
;$(function () {
	"use strict";
	var reURL = /^(?:(?:https?):\/\/)(?:\S+(?::\S*)?@)?(?:(?!(?:10|127)(?:\.\d{1,3}){3})(?!(?:169\.254|192\.168)(?:\.\d{1,3}){2})(?!172\.(?:1[6-9]|2\d|3[0-1])(?:\.\d{1,3}){2})(?:[1-9]\d?|1\d\d|2[01]\d|22[0-3])(?:\.(?:1?\d{1,2}|2[0-4]\d|25[0-5])){2}(?:\.(?:[1-9]\d?|1\d\d|2[0-4]\d|25[0-4]))|(?:(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)(?:\.(?:[a-z\u00a1-\uffff0-9]-*)*[a-z\u00a1-\uffff0-9]+)*(?:\.(?:[a-z\u00a1-\uffff]{2,}))\.?)(?::\d{2,5})?(?:[/?#]\S*)?$/i, //https://gist.github.com/dperini/729294
		$inputs = [$("#test"), $("#resultat1"), $("#resultat2"), $("#resultat3")];
	$("form").on("submit", function (e) {
		e.preventDefault();
		var url = $inputs[0].val();
		$inputs[1].text("");
		$inputs[2].text("");
		$inputs[3].text("");
		if (! reURL.test(url))
			return;
		$.ajax({
			url: "http://www.equatorium.net/e1/ou--outils/proxy.php?query=" + url,
			success: function (got, status, xhr) {
				var mimeType = xhr.getResponseHeader("content-type") || ""; //http://marcgrabanski.com/jquery-ajax-content-type/
				$inputs[1].text(this.url);
				$inputs[2].text(mimeType);
				$inputs[3].text(xhr.responseText.substring(0, 400));
			},
			error: function (xhr, status, err) {
				console.log(err);
				try{
					var mimeType = xhr.getResponseHeader("content-type") || ""; //http://marcgrabanski.com/jquery-ajax-content-type/
					$inputs[1].text(this.url);
					$inputs[2].text(mimeType);
					$inputs[3].text(xhr.responseText.substring(0, 400));
				} catch (e) { console.log(e); }
}	});	});	});
</script>
</body>
</html>
